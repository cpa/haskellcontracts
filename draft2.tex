\documentclass{article}

\usepackage{stmaryrd}
\usepackage{amsmath}
\usepackage{fullpage}

\begin{document}

\section{Language}

\newcommand{\unr}{\texttt{UNR}}
\newcommand{\unrphi}{\texttt{UNR}_\phi}
\newcommand{\bad}{\texttt{BAD}}
\newcommand{\badphi}{\texttt{BAD}_\phi}
\newcommand{\any}{\texttt{Any}}
\newcommand{\ok}{\texttt{Ok}}
\newcommand{\let}{\mbox{let }}
\newcommand{\mand}{\mbox{ and }}
\newcommand{\motherwise}{\mbox{ otherwise.}}

\begin{eqnarray*}
  x,D &::=& String & (Variables, Data)\\
  e &::=& x \mid e~e \mid D~e \mid \bad \mid \unr & (Expressions) \\
  p &::=& \mbox{let $f~x_1,\dots,x_n = $ case $e$ of } [(p_1 \to e_1) \dots (p_n \to e_n)] ::: t,p   & (Programs) \\ 
  &&\mid \mbox{let } f~x_1,\dots,x_n = e ::: t,p \mid \epsilon \\
  t &::=& \{x \mid e \} \mid x:t \to t \mid \any & (Contracts) \\
  \phi &::=& \top \mid \bot \mid x \mid \lnot \phi \mid \phi \land \phi \mid \forall x, \phi & (FOF) \\
\end{eqnarray*}

With the constraint that the Haskell expression in the contract must return a Bool.

$t \geq t' \iff \{ e | x \in t' \} \subset \{ e | x \in t \}$ ($t$ is more restrictive than $t'$)

case-expression can't be nested (just as lambdas) which is simpler for the FOL translation.

\section{Encoding}


\subsection{Expressions}
\begin{itemize}
\item $\llbracket e \in \{ x | p(x) \} \rrbracket = p(e)$
\item $\llbracket e \in t_1 \to t_2 \rrbracket = \forall x, \llbracket x \in t_1 \rrbracket \to \llbracket e~x \in t_2 \rrbracket$
\end{itemize}

\thispagestyle{empty}

\subsection{Programs}
Assume $t = t_1 \to \dots \to t_n \to t_c$.

\begin{itemize}
\item $\llbracket \mbox{let } f~x_1 \dots x_n = e ::: t \rrbracket = (\forall_{1 \leq i \leq n} x_i, \bigwedge_{1 \leq i \leq n} \llbracket x_i \in t_i \rrbracket~\forall f^\star \llbracket f^\star \in t \rrbracket) \to \llbracket e[f^\star/f] \in t_c \rrbracket$
\item $\llbracket \mbox{let } f~x_1 \dots x_n = \mbox{ case } e \mbox{ of } [(p_i,e_i)] \in t \rrbracket = (\forall x_i, \bigwedge_{i \leq n} \llbracket x_i \in t_i \rrbracket~\forall f^\star \llbracket f^\star \in t \rrbracket) \to (\bigwedge_{j \leq k} p_j = e \to \llbracket e_j[f^\star/f] \in t_c \rrbracket)$
\end{itemize}

\thispagestyle{empty}
\end{document}

